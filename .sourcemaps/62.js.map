{"version":3,"sources":["../../src/spa/+screens/orderManagement/orderMixBasket/orderMixBasketStep1/orderMixBasketStep1.ts","../../src/spa/+screens/orderManagement/orderMixBasket/orderMixBasketStep1/orderMixBasketStep1.service.ts","../../src/spa/+screens/orderManagement/orderMixBasket/orderMixBasketStep1/orderMixBasketStep1.module.ts"],"names":[],"mappings":"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","file":"62.js","sourcesContent":["import { Component } from '@angular/core';\nimport { IonicPage, NavController } from 'ionic-angular';\nimport { RouteManagerService } from '../../../../framework/services/routeManager/routeManager.service';\nimport { Utils } from \"../../../../framework/services/utilities/utilities\";\nimport { MyShoppingBasketSharingDataService } from \"../../../myShoppingBasket/myShoppingBasketSharingData.services\";\nimport { LoadingIndicatorService } from \"../../../../framework/services/loadingIndicatorService/loadingIndicator.service\";\nimport { ToastMessageService } from \"../../../../framework/services/toastMessageService/toastMessage.service\";\nimport { OrderMixBasketStep1Service } from \"./orderMixBasketStep1.service\";\nimport { AppConfig as app } from \"../../../../framework/appConfig\";\n\nconst DEFAULT_ERROR_MSG = app.Configuration.HttpService.DEFAULT_ERROR_MSG;\n\n@IonicPage()\n@Component({\n  selector: 'page-orderMixBasketStep1',\n  templateUrl: 'orderMixBasketStep1.html',\n  providers: [\n    OrderMixBasketStep1Service\n  ]\n})\nexport class OrderMixBasketStep1 {\n  primaryCard: any;\n  orderAfterGenerate: any;\n  currency: any;\n  dataFromBasket: any;\n  currentIndexDelivery = 0;\n  _updateDeliveryMethod;\n  totalFee = 0;\n  totalFeeDelivery = 0;\n  totalPrice = 0;\n  totalPotentialFee = 0;\n  allProductsOnBasket;\n  baseResourceUrl;\n  constructor(public routeManager: RouteManagerService,\n    public navCtrl: NavController,\n    private orderMixBasketStep1Service: OrderMixBasketStep1Service, ) {\n    this.baseResourceUrl = app.Configuration.HttpService.baseResourceUrl;\n  }\n\n  ionViewWillEnter() {\n    if (this.routeManager.ifNotLoggedInThenGoBackToLoginScreen() === false) {\n      this.primaryCard = MyShoppingBasketSharingDataService.getInstance().getPrimaryCard();\n      this.orderAfterGenerate = MyShoppingBasketSharingDataService.getInstance().getDataAfterGenerateOrder();\n\n      let dataBasket = MyShoppingBasketSharingDataService.getInstance().getDataBasket();\n      this.allProductsOnBasket = dataBasket.productsOnBasket;\n\n      if (Utils.isNotNull(this.primaryCard)) {\n        this.currency = Utils.convertCurrency(this.primaryCard.currency);\n      }\n      if (Utils.isNotNull(this.orderAfterGenerate)) {\n        this.calculateTotal(this.orderAfterGenerate.orderlines, 0);\n      }\n    }\n  }\n\n  calculateTotal(products, index) {\n    this.totalFee = 0;\n    this.totalPrice = 0;\n    this.totalFeeDelivery = 0;\n    this.totalPotentialFee = 0;\n    if (Utils.isNotNull(products) && products.length > 0) {\n      for (let i = 0; i < products.length; i++) {\n        this.totalFee += products[i].feeAmount;\n      }\n      this.totalFeeDelivery = this.orderAfterGenerate.availableDeliveryMethods[index].cost;\n\n      this.totalPotentialFee = this.totalFee + this.totalFeeDelivery;\n      this.totalPrice = this.orderAfterGenerate.totalPaymentAmount + this.totalPotentialFee;\n    }\n  }\n\n  setActiveIndex(index) {\n    this.currentIndexDelivery = index;\n    this.calculateTotal(this.orderAfterGenerate.orderlines, index);\n  }\n\n  updateDelivery() {\n    if (this._updateDeliveryMethod) {\n      this._updateDeliveryMethod.unsubscribe();\n    }\n    let orderData = this._buildUpdateDeliveryMethodRequest();\n    LoadingIndicatorService.getInstance().showLoadingIndicator();\n    this._updateDeliveryMethod = this.orderMixBasketStep1Service.updateDeliveryMethod(orderData)\n      .subscribe((res) => {\n        if (!res.ok) {\n          return;\n        }\n\n        this.navCtrl.push('OrderExchangeGiftCardStep2', { deliveryIndex: this.currentIndexDelivery });\n      }, (error) => {\n        LoadingIndicatorService.getInstance().hideLoadingIndicator();\n      }, () => {\n        LoadingIndicatorService.getInstance().hideLoadingIndicator();\n      });\n  }\n\n  private _buildUpdateDeliveryMethodRequest() {\n    let orderSummary =\n      {\n        \"propositionId\": this.primaryCard.propositionId,\n        \"orderNumber\": this.orderAfterGenerate.orderNumber,\n        \"title\": this.orderAfterGenerate.title,\n        \"firstName\": this.orderAfterGenerate.firstName,\n        \"lastName\": this.orderAfterGenerate.lastName,\n        \"addressLine1\": this.orderAfterGenerate.addressLine1,\n        \"addressLine2\": this.orderAfterGenerate.addressLine2,\n        \"town\": this.orderAfterGenerate.town,\n        \"county\": this.orderAfterGenerate.county,\n        \"postcode\": this.orderAfterGenerate.postcode,\n        \"country\": this.orderAfterGenerate.country,\n        \"deliveryMethodCode\": this.orderAfterGenerate.availableDeliveryMethods[0].code,\n      }\n\n    return orderSummary;\n  }\n\n  private _showError(message) {\n    ToastMessageService.getInstance().showToastMessage(message);\n  }\n\n  private _handleError(res) {\n    LoadingIndicatorService.getInstance().hideLoadingIndicator();\n    let msg = DEFAULT_ERROR_MSG;\n    try {\n      let body = JSON.parse(res._body);\n      msg = body.errors[0].message;\n    } catch (e) {\n      msg = DEFAULT_ERROR_MSG;\n    }\n    this._showError(msg);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/spa/+screens/orderManagement/orderMixBasket/orderMixBasketStep1/orderMixBasketStep1.ts","import { Injectable } from \"@angular/core\";\nimport { Observable } from \"rxjs/Observable\";\nimport {HttpService} from \"../../../../framework/services/httpService/http.service\";\n\n@Injectable()\nexport class OrderMixBasketStep1Service {\n\n  constructor(\n      private http: HttpService\n  ) {\n  }\n\n  confirmOrder(orderInfor): Observable<any> {\n    return this.http.post(\"order/payment/flexecash\", orderInfor);\n  }\n\n  updateDeliveryMethod(orderInforToUpdateDelivery): Observable<any> {\n    return this.http.put(\"order/delivery\", orderInforToUpdateDelivery);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/spa/+screens/orderManagement/orderMixBasket/orderMixBasketStep1/orderMixBasketStep1.service.ts","import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { OrderMixBasketStep1 } from './orderMixBasketStep1';\n\n@NgModule({\n  declarations: [OrderMixBasketStep1],\n  imports: [IonicPageModule.forChild(OrderMixBasketStep1)],\n  exports: [OrderMixBasketStep1]\n})\nexport class OrderMixBasketStep1Module { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/spa/+screens/orderManagement/orderMixBasket/orderMixBasketStep1/orderMixBasketStep1.module.ts"],"sourceRoot":""}